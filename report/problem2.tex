\section{Optimal Control of Pitch/Travel without Feedback}\label{sec:prob2}

\subsection{State-space formulation}
\begin{equation}
\begin{aligned}
	\dot{x}&=\begin{bmatrix} \dot{\lambda} \\ \dot{r}  \\ \dot{p} \\ \ddot{p} \end{bmatrix}
	= A_cx + B_cu
	\\
	A_c &= \begin{bmatrix} 0 & 1 & 0 & 0 \\ 0 & 0 & K_2 & 0 \\ 0 & 0 & 0 & 1 \\ 0 & 0 & -K_1K_p & -K_1K_{pd} \end{bmatrix}
	B_c = \begin{bmatrix}0 \\ 0 \\ 0 \\K_1K_{pp} \end{bmatrix}
\end{aligned}
\end{equation}
This is a model of the pitch and travel of the helicopter and the pitch controller of the basic control layer. Optimization layer and derivation is not inlcuded.


\subsection{Discretization}
\begin{equation}
\begin{aligned}
	\frac{x_{k+1} - x_k}{\Delta t} &= A_c x_k + B_c u_k
	\\
	x_{k+1} &= (I + A_c \Delta t)x_k + B_c \Delta t u_k = Ax_k+Bu_k
\end{aligned}
\end{equation}

\subsection{Computation of optimal trajectory}
An optimal trajectory can be generated by minimizing the cost function
\begin{equation}
	\label{eq:trajectory_cost}
	\phi = \sum_{i=1}^{N}(\lambda_i - \lambda_f)^2 + qp_{ci}^2
\end{equation}
for some scalar weight $q \geq 0$ over the finite horizon of states and inputs
\begin{equation}
	z = (x_1 \; x_2 \; ... \; x_N \; u_1 \; u_2 \; ... \; u_N)^T
\end{equation}
The discrete-time system dynamics are implemented as equality constraints of the form $A_{\text{eq}}z = B_{\text{eq}}$, where $A_{\text{eq}}$ and $B_{\text{eq}}$ are given by the left- and right-hand side of the $N$ constraints
\begin{align*}
	x_1 - Bu_0        &= Ax_0 \\
	x_2 - Ax_1 - Bu_1 &= 0    \\
	\vdots                    \\
	x_N - Ax_{N-1} - Bu_{N-1} &= 0
\end{align*}
We would also like to constrain the system state and input to be within a range
\begin{align}
	x^{\text{min}} \leq x_{t+1} \leq x^{\text{max}} \\
	u^{\text{min}} \leq u_t \leq u^{\text{max}}
\end{align}
for $t = 0...N-1$. Applying these constraints to all states and inputs in the solution horizon, we have
\begin{equation}
	\begin{bmatrix} I \\ -I \end{bmatrix} z
	\leq
	\begin{bmatrix}
	\{x_{t+1}^{max}\} \\
	\{u_t^{max}\} \\
	\{x_{t+1}^{min}\} \\
	\{u_t^{min}\}
	\end{bmatrix}_{t=0..N-1}
\end{equation}
which can be implemented as an inequality constraint of the form $A_{\text{iq}} z \leq B_{\text{iq}}$.

Note that the cost function (\ref{eq:trajectory_cost}) does not take into consideration that $\lambda_i$ plus some multiple of $2\pi$ describes the same physical orientation of the helicopter. For example, if the reference is $0$ and $\lambda_i = 2\pi$, it will be regarded as a large error, even though the helicopter is infact in the desired orientation. A more optimal scheme would take this into consideration.
